# TowerDefense

NJU高程项目二，一个塔防游戏。



## run

这是个QT项目，用到的版本是：`QT Creator 5.0.2`。

**创建一个新项目**，然后把源文件都加进去，运行后会有对应的名为类似`build-Pro2-Desktop_Qt_5_12_12_MinGW_64_bit-Debug/`的目录创建，里面是qmake编译生成的中间文件和`exe`文件啥的。

将资源文件`sources/`，`map_config_default*.txt`和`rankings.txt`和这个`build`目录同级即可，不然会报错啥的。

> `clone`下来直接跑是跑不通的，反正我是不行☹



## intro

素材图片在`/sources`文件夹下，主要偷自PvZ，保卫萝卜和元气骑士。

这个项目需求也是及其的缝合，对塔和敌人，以及路径要求很多：

* 我方塔：
  * 近战塔：
    * 阻拦数为0的：有攻击能力，但拦不住敌人，我的实现是地刺
    * 攻击力为0的：没攻击能力，能拦一些敌人，血厚，我的实现是坚果
    * 只攻击地面单位的：我的实现是科学家，能够发波，而且能手动设置朝向
    * 能攻击飞行单位的：敌人的地面单位和飞行单位都能攻击，我的实现是火炬
  * 远程塔：
    * 能自动放置我方单位的：我的实现是个盲盒，有计时器，计时器到了随机种一个塔，所以比较贵
    * 只攻击敌方地面单位的：保卫萝卜里的豌豆炮
    * 能攻击敌方飞行单位的：保卫萝卜里的汽油瓶子

* 敌人：
  * 地面单位：
    * 进程攻击我方近战塔的
    * 远程攻击我方近战塔的
    * 能攻击我方远程塔的
    * 给队友加buff的：我的实现是加血，元气骑士里的巫师
  * 飞行单位：保卫萝卜里找的两个蝙蝠
    * 恋战的：攻击范围有我方塔则停止不前
    * 畏战的：攻击范围有我方塔也继续前进

* 格子：
  * 我方的近战单位可以部署的格子, 简称近战格子。
  * 我方的远程单位可以部署的格子, 简称远程格子。
  * 我方的所有单位都不能部署的格子。
* 路径：
  * 敌方的飞行单位使用的路径, 简称飞行路径，云朵。
  * 敌方的地面单位使用的路径, 简称地面路径。

> 捏麻麻这需求和绕口令一样。



游戏运行先是让你选关，默认了三关

<img src=".\assets\begin.png" style="zoom:50%;" />

点击后加载对应的`map_condif_default*.txt`文件，地图文件就是个数字矩阵，每个数字代表对应格子的类型，具体实现见`Map`类，想要自定义地图直接改配置上的数字即可。

> 敌人的行走路径是回溯找出来的，加载地图的时候就确定了



<img src=".\assets\show.gif" style="zoom: 50%;" />

操作方法也比较简单，点击格子就有显示能种植的塔，再点击能显示范围以及是否销毁，销毁能归还一些金钱，科学家还能调整朝向（适合放在十字路口）

> 多种地刺就能应付地面单位，出来飞行敌人后再种豌豆炮和汽油瓶子也不迟



赢了的话会有个让你输入名称的界面，展示排行榜啥的。



## details

差不多忘完了，反正就是嗯缝嗯debug。

塔和敌人的实现的话就是继承那套，细节忘了。

* 单位如何动

  实现动态效果我的方法很池沼，因为QT不太熟悉，本来想的是直接设置gif图但是死活整不上，最后就是堆素材轮播图片，所以人物看起来都是一扭一扭的。

* 游戏的驱动

  核心在`gamewindow`类：

  * 所有的绘图动作都在`gamewindow::paintEvent`里，不绘制游戏相当于黑盒运行，但是会输出日志。

  * 两个`QTimer`计时器模拟了引擎，一个用于驱动游戏进行，一个用于生成敌人。

    计时器绑定`update_all()`函数，其中调用了所有单位的`update()`函数，每个单位的`update()`函数实现都不同，相似点都是血量，位置，展示图片等等的更新。只要时钟信号够快，游戏看起来就是连贯的。

* 敌人如何寻路

  路径在加载地图时深搜搜出来的，记录在`vector<Pos_t> path`属性中，每个`Pos_t`就是移动方向，按照所处位置读取当前的移动方向修改坐标即可。



​	

## features

* 能展示单位的状态，就是头顶飘的小图标，受到攻击或者濒死啥的。

* 豌豆炮和汽油瓶血量少的时候还有技能，一个是子弹能够穿透，一个是伤害变高。

* 因为项目要求是有个可以自动放置我方单位的远程塔，这玩意助教自己都说不清楚是啥，所以en整了个盲盒，头顶有计时器的条。

剩下忘了，感觉细节挺丰富。



-----

这个项目给了个文档之后就纯纯放养了，每周象征性验收一下，最后验收的时候助教还问我有没有实现既能够放近战塔又能够放远程塔的格子。我说文档没有写😅最后也逼他给了满分。



高程项目占比太低，建议不要care细节和鲁棒性，用最简单的方式完成需求就去睡大觉。
